# Pre-push checks
echo "üîç Running pre-push checks..."

# 1. Type checking (critical)
echo "üìù Type checking..."
pnpm turbo run type-check --filter=@travelmatch/mobile
if [ $? -ne 0 ]; then
  echo "‚ùå Type check failed. Fix type errors before pushing."
  exit 1
fi
echo "‚úÖ Type check passed"

# 2. Lint check
echo "üîß Lint checking..."
pnpm turbo run lint --filter=@travelmatch/mobile
if [ $? -ne 0 ]; then
  echo "‚ùå Lint check failed. Fix lint errors before pushing."
  exit 1
fi
echo "‚úÖ Lint check passed"

# 3. Run critical tests only (unit tests, skip E2E/integration)
echo "üß™ Running critical unit tests..."
cd apps/mobile && pnpm test -- --passWithNoTests --testPathPattern="src/(components|hooks|utils)/__tests__" --testPathIgnorePatterns="integration|e2e|performance" --maxWorkers=2 2>/dev/null
TEST_EXIT=$?
cd ../..

if [ $TEST_EXIT -ne 0 ]; then
  echo "‚ö†Ô∏è  Some tests failed. Review before pushing."
  echo "   Run 'pnpm test' in apps/mobile to see details."
  # Don't block push, but warn
fi

echo "‚úÖ Pre-push checks complete!"
