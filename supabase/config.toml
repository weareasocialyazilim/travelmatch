# Supabase Project Configuration
# See: https://supabase.com/docs/guides/cli/config

project_id = "bjikxgtbptrvawkguypv"

[api]
enabled = true
port = 54321
schemas = ["public", "storage"]
extra_search_path = ["public", "extensions"]
max_rows = 1000

[db]
port = 54322
shadow_port = 54320
major_version = 17

[studio]
enabled = true
port = 54323
# NOTE: This api_url is for LOCAL DEVELOPMENT ONLY.
# Supabase Studio is only available locally via `supabase start`.
# Production uses the Supabase Dashboard at https://app.supabase.com
# This setting has NO EFFECT in deployed environments.
api_url = "http://localhost"

[inbucket]
enabled = true
port = 54324
smtp_port = 54325
pop3_port = 54326

[storage]
enabled = true
file_size_limit = "50MiB"

[db.pooler]
enabled = true
# Use percentage-based allocation instead of absolute number
# This allows Auth to scale automatically with instance size
port = 6543
pool_mode = "transaction"
default_pool_size = 20
max_client_conn = 100

[auth]
enabled = true
# Production site URL (primary domain)
site_url = "https://lovendo.app"
# Redirect URLs for OAuth callbacks and deep links
additional_redirect_urls = [
  "https://www.lovendo.app",
  "https://staging.lovendo.app",
  "lovendo://",  # Mobile app deep link (prefix match)
  "lovendo://auth/callback",  # OAuth callback for social login
]
jwt_expiry = 3600
enable_refresh_token_rotation = true
refresh_token_reuse_interval = 10
enable_signup = true
# Security: Check passwords against HaveIBeenPwned database
# Prevents users from using known compromised passwords
enable_manual_linking = false

[auth.email]
enable_signup = true
double_confirm_changes = true
# Email confirmation disabled - phone verification is used instead
# Users verify their phone number after registration via Twilio
enable_confirmations = false
# SendGrid SMTP configuration (production)
# Configure in Supabase Dashboard > Authentication > Email Templates
# SMTP Settings:
#   Host: smtp.sendgrid.net
#   Port: 587
#   Username: apikey
#   Password: env(SENDGRID_API_KEY)
#   Sender email: noreply@lovendo.app
#   Sender name: Lovendo

[auth.sms]
enable_signup = true
enable_confirmations = true
# Twilio SMS configuration
# For LOCAL development: SMS is disabled (no provider configured)
# For PRODUCTION: Configure via Supabase Dashboard > Authentication > Phone
#
# Production Twilio Settings (Dashboard):
#   - Provider: Twilio
#   - Account SID: ACb4dcfed70be9a397127d9da06a127994
#   - Auth Token: (from Infisical TWILIO_AUTH_TOKEN)
#   - Message Service SID: VA48e795fedf9018794218fb50099676fb
#
# See: https://supabase.com/docs/guides/auth/phone-login

# SMS OTP settings
# max_frequency = 60 (seconds between OTP requests)
# otp_length = 6
# otp_exp = 300 (5 minutes)

[auth.external.apple]
enabled = false
# Apple Sign In credentials configured via Supabase Dashboard (production only):
# - Service ID (client_id)
# - Team ID
# - Key ID
# - Private Key (.p8 file contents)
# See: https://supabase.com/docs/guides/auth/social-login/auth-apple

[auth.external.google]
enabled = false
# Google OAuth credentials configured via Supabase Dashboard (production only):
# - Client ID
# - Client Secret
# See: https://supabase.com/docs/guides/auth/social-login/auth-google

[functions]
# Edge Functions configuration
# verify_jwt = false

[functions.handle-storage-upload]
verify_jwt = false
# Note: This function is called via storage webhook trigger
# The webhook trigger uses pg_net to call the function without JWT
# JWT verification is disabled because the trigger authenticates at DB level
